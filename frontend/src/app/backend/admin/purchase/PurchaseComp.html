<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
  <h5 class="my-2 py-3 px-3 bg-secondary text-light fw-bold">Add New Purchase</h5>
  <form [formGroup]="purchaseFg">
    <div class="row">
      <div class="mb-3 col-6">
        <label class="form-label fw-bold">Select an Employee</label>
        <ng-select [items]="employeeList$ | async" bindLabel="name" formControlName="employee">
        </ng-select>
      </div>
      <div class="mb-3 col-6">
        <label class="form-label fw-bold">Select a Supplier</label>
        <ng-select [items]="supplierList$ | async" bindLabel="name" formControlName="supplier">
        </ng-select>
      </div>
      <div class="mb-3 col-12">
        <label class="form-label fw-bold">Purchase Note</label>
        <textarea class="form-control" formControlName="note"></textarea>
        <div id="name-help" class="form-text">
          We'll never share your name with anyone else.
        </div>
      </div>
      <div class="mb-3 col-6">
        <label class="form-label fw-bold">Total Purchase Amount</label>
        <input type="number" class="form-control" formControlName="totalAmount">
        <div id="name-help" class="form-text">
          We'll never share your name with anyone else.
        </div>
      </div>
      <div class="mb-3 col-6">
        <label class="form-label fw-bold">Other Costs</label>
        <input type="number" class="form-control" formControlName="otherCost">
        <div id="name-help" class="form-text">
          We'll never share your name with anyone else.
        </div>
      </div>
      <div class="col-12">
        <h5 class="my-2 py-3 px-3 bg-secondary text-light fw-bold">Add Purchase Details</h5>
        <div>
          <button (click)="addPurchaseDetail()" class="btn waves-effect btn-info waves-light mt-2 mx-1">
            + New
          </button>
          <div formArrayName="purchaseDetailList">
            <div *ngFor="let fg of toFaGfn(this.purchaseFg.get('purchaseDetailList')).controls;
                    let index = index">
              <div [formGroupName]="index">
                <div class="row">
                  <div class="mb-4 mt-2 col">
                    <label class="form-label fw-bold">Select Product</label>
                    <ng-select [items]="productList$ | async" bindLabel="name" formControlName="product">
                    </ng-select>
                  </div>
                  <div class="mb-4 mt-2 col">
                    <label class="form-label fw-bold">Add Quantity</label>
                    <input type="number" formArrayName="quantity" class="form-control">
                  </div>
                  <div class="mb-4 mt-2 col">
                    <label class="form-label fw-bold">Price</label>
                    <input type="number" formArrayName="unitPrice" class="form-control">
                  </div>
                  <hr>
                  <!-- <button (click)="deleteDetail(fg,index)" class="btn btn-outline-primary waves-effect col">Delete</button> -->
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="d-flex justify-content-center">
      @if (purchaseFg.controls['updateMode'].value == true) {
      <button type="submit" class="btn btn-info col-3 my-2" (click)="update()">Update</button>
      }
      @else {
      <button type="submit" class="btn btn-primary mx-1 col-3 my-2" (click)="save()">Save</button>
      }
      <button type="submit" class="btn btn-info mx-1 col-3 my-2" (click)="search()">Search</button>
      <button type="submit" class="btn btn-success mx-1 col-3 my-2" (click)="reset()">Reset</button>
    </div>
  </form>
  <div class="row my-3">
    <div class="col-12">
      <h5 class="my-2 py-3 px-3 bg-secondary text-light fw-bold">All Purchases</h5>
      <table class="table">
        <thead class="table-light">
          <tr>
            <th>Purchase ID</th>
            <th>Supplier</th>
            <th>Detail</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let purchase of purchaseList$ | async; let i = index">
            <td>{{purchase.id}}</td>
            <td>{{purchase.supplier}}</td>
            <td>
              @if(purchase.enabled == true)
              {
              Active
              }
              @else
              {
              Inactive
              }
            </td>
            <td>
              @if(purchase.enabled == false)
              {
              <button type="button" (click)="onUpdateClick(purchase)"
                class="btn btn-success waves-effect waves-light mx-1">
                Make Active
              </button>
              }
              <button type="button" (click)="onUpdateClick(purchase)"
                class="btn btn-info waves-effect waves-light mx-1">
                View Details
              </button>
              <button type="button" (click)="onUpdateClick(purchase)"
                class="btn btn-info waves-effect waves-light mx-1">
                Edit
              </button>
              <button type="button" (click)="delete(purchase)" class="btn btn-danger waves-effect waves-light mx-1">
                Delete
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</main>